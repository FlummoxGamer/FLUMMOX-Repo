name: Diagnose Build

on:
  push:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: List All Tasks
      run: |
        chmod +x gradlew
        ./gradlew tasks --all
        
    - name: Check Project Structure
      run: |
        echo "=== Project Structure ==="
        find . -name "*.kt" -type f
        echo "=== Source Files ==="
        find GhostStreamProvider/src -type f
        echo "=== Settings ==="
        cat settings.gradle.kts || echo "No settings file"
        
    - name: Try Different Build Commands
      run: |
        echo "=== Try assemble ==="
        ./gradlew :GhostStreamProvider:assemble || echo "assemble failed"
        echo "=== Try jar ==="
        ./gradlew :GhostStreamProvider:jar || echo "jar failed"
        echo "=== Try compileJava ==="
        ./gradlew :GhostStreamProvider:compileJava || echo "compileJava failed"
        echo "=== Try compileKotlin ==="
        ./gradlew :GhostStreamProvider:compileKotlin || echo "compileKotlin failed"
        
    - name: List Results
      run: |
        echo "=== Final JAR search ==="
        find . -name "*.jar" -type f
        echo "=== Build directories ==="
        find . -name "build" -type d | head -10
